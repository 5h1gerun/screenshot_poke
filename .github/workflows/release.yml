name: Notify Discord on Release

on:
  release:
    types: [published, edited]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Embed notification
        run: |
          release_url="$GITHUB_SERVER_URL/$GITHUB_REPOSITORY/releases/tag/$GITHUB_REF_NAME"
          body=$(jq -nc \
            --arg title "📢 新しいリリース: $GITHUB_REF_NAME" \
            --arg url "$release_url" \
            --arg desc "${GITHUB_REPOSITORY} のリリースが公開・更新されました。" \
            --argjson color 5814783 \
            '{embeds: [{title: $title, url: $url, description: $desc, color: $color}]}' )

          curl -H "Content-Type: application/json; charset=utf-8" \
               -X POST \
               -d "$body" \
               ${{ secrets.DISCORD_WEBHOOK }}
